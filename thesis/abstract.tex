\chapter*{Abstract}

The Internet-of-Things (IoT) is an ever growing network of devices connected to the Internet. Such devices are heterogeneous in their protocols and computation capabilities. With the rising computation and connectivity capabilities of these devices, the possibilities of their use in IoT systems increases. Concepts like smart cities are the pinnacle of the use of these systems, which involves a big amount of different devices in different conditions.

There are several tools for building IoT systems; some of these tools have different levels of expertise required and employ different architectures. One of the most popular is Node-RED. It allows users to build systems using a visual data flow architecture, making it easy for a non-developer to use it.

However, most of these mainstream tools employ centralized methods of computation, where a main component --- usually hosted in the cloud --- executes most of the computation on data provided by edge devices, \emph{e.g.} sensors and gateways. There are multiple consequences to this approach: (a)~edge computation capabilities are being neglected, (b)~it introduces a single point of failure, and (c)~local data is being transferred across boundaries (private, technological, political...) either without need, or even in violation of legal constraints. Particularly, the principle of Local-First --- \emph{i.e.}, data and logic should reside locally, independent of third-party services faults and errors --- is blatantly ignored.

Previous work attempt to mitigate some of these consequences, usually through tools that extend existing visual programming frameworks, such as Node-RED. They go as far as to propose a solution to decentralize flows and its execution in fog/edge devices. So far, achieving such decentralization requires that the decomposition and partitioning effort be manually specified by the developer when building the system.

Our goal is to extend Node-RED to allow automatic decomposition and partitioning of the system towards higher decentralization. With this in mind, we implemented firmware for taking advantage of the resources of the external devices, as well as new nodes and modification in Node-RED that allow orchestration of tasks. The firmware consists of a service that responds to requests as well as executes MicroPython scripts given to it. Node-RED was modified to take advantage of this firmware by (1) implementing a device registry that allows devices to announce themselves, (2) generating MicroPython code from nodes and (3) assigning nodes to devices based on properties and priorities of both devices and nodes. Besides this, a mechanism was developed to automatically detect of abnormal run-time conditions, providing dynamic self-adaptation.

The solution was validated by implementing home automation scenarios, where several experiments were made. These experiments made use of virtual and physical devices. Several metrics were measured to allow a conclusion regarding the resiliency, efficiency and elasticity of the system. With this data, we were able to conclude that the system allows for a different number of devices, it is less efficient than Node-RED and is robust, despite some specific cases where problems might arise.

\vspace*{10mm}\noindent
\textbf{Keywords}: Internet of Things, Visual Programming, Edge Computing

\chapter*{Resumo}

A Internet-of-Things (IoT) é uma rede de dispositivos conectados à Internet em constante crescimento. Estes dispositivos são heterogéneos nos seus protocolos e capacidades de computação. Com o crescimento das capacidades de computação e conectividade destes dispositivos, as possibilidades do seu uso em sistemas IoT aumentaram. Conceitos como Cidades Inteligientes são o pináculo do uso destes sistemas, que envolvem um grande número de dispositivos diferentes em diferentes condições.

Existem várias ferramentas para construir sistemas IoT; algumas destas ferramentas requerem diferentes níveis de perícia e usam diferentes arquiteturas. Uma das ferramentas mais populares é Node-RED. Esta permite aos seus utilizadores construir sistemas usando uma arquitetura visual de \emph{data flow}, tornando o processo mais fácil para um utilizador não programador.
\par No entanto, a maioria das ferramentas convencionais usam métodos centralizados de computação, onde um componente principal - normalmente alocado na \emph{cloud} - executa a maioria da computação nos dados provenientes dos dispositivos \emph{edge}, \emph{e.g.} sensores e \emph{gateways}. Com esta abordagem estão associadas multiplas consequências: (a) capacidades de computação de dispositivos \emph{edge} estão a ser neglegenciadas, (b) introduz um único ponto de falha, e (c) data local está a ser transferida através de limites (privados, tecnológicos, políticos...) sem necessidade ou violando restrições legais. Especificamente, o princípio de \emph{Local-First} - \emph{i.e.}, dados e lógica devem residir localmente, independentemente de falhas e erros de serviços terceiros - é totalmente ignorado.

Trabalhos feitos até agora tentam mitigar algumas destas consequências, construindo ferramentas que estendem ferramentas existentes de programação visual, como Node-RED. Algumas propõe uma solução que consiste na descentralização de \emph{flows} e a sua execução em dispositivos de \emph{fog} e \emph{edge}. Atualmente, para obter a este tipo de descentralização é necessário que o esforço de decomposição e partição seja manualmente efetuado pelo programador quando este constrói o sistema.

O nosso objetivo é estender a ferramenta Node-RED para permitir a decomposição e partição automática do sistema com o fim de obter uma maior descentralização. Com isto em mente, implementámos \textit{firmware} que tira partido dos recursos dos dispositivos externos, assim como novos nós e moficiações no Node-RED que permitem a orquestração de tarefas. O \textit{firmware} consiste num serviço que responde a pedidos e executa o código MicroPython recebido. Para aproveitar este \textit{firmware}, Node-RED foi alterado com (1) uma implementação de um registo de dispositivos que permite que estes se anunciem, (2) geração de código MicroPython a partir de nós e (3) alocamento de nós a dispositivos baseado em propriedades e prioridades tanto dos dispositivos como dos nós. Para além disto, foi desenvolvido um mecanismo que deteta automaticamente condições anormais dos dispositivos em \emph{run-time}, levando o sistema a adaptar-se.

Para validar a solução, foi desenvolvido um cenário de \textit{home automation}, onde diversas experiências foram feitas. Estas experiências usaram dispositivos virtuais e físicos. Foram medidas várias métricas que permitiram chegar a conclusões acerca da resiliência, eficiência e elasticidade do sistema. Com estes dados, pudemos concluir que a solução desenvolvida permite o uso de diferente número de dispositivos, é menos eficiente que o Node-RED e é robusta, exceto em alguns casos específicos que podem causar problemas.

\vspace*{10mm}\noindent
\textbf{Keywords}: Internet of Things, Visual Programming, Edge Computing
